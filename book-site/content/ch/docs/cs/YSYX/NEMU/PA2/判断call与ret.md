对于 *riscv32* 指令集来说：

- `jal`可以用于近距离函数调用（距离当前pc不超过 *±1MB* 的函数）；
- `jalr` 可以用于函数返回以及远距离函数调用
- 但是，**这两条指令并不一定用于函数返回和调用**。

因此，需要找出：

- `jal` 什么时候用于函数调用
- `jalr` 什么时候用于函数调用
- `jalr` 什么时候用于函数返回

为了保证正确性，以及维护调用栈，可以使用一个栈来记录未返回的函数以及其返回地址。

用如下数据结构作为调用栈：

```c
typedef {
  size_t idx
  uint32_t ret_addr
} ret_stk_e;

ret_stk[30];
```



# 1. `jal`，jalr 用于函数调用

---

1. 跳转到一个函数首地址
2. 使用 `$ra` 存放 `PC + 4`

# 1. jalr 用于返回

栈顶未返回的函数的返回地址应该与 `jalr` 跳转的目的地址相同。

 